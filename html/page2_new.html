<!doctype html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>穿越</title>
	<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
	<link rel="stylesheet" href="../css/page2.css">
</head>
<body>
    <div class="msg-page show">
        <div class="msg-top"></div>
        <div class="msg-inner">
            <div class="msg-wrapper msg-dream">
                <div class="clearfix">
                    <p class="msg-box fl">
                        你的梦想是什么？
                    </p>
                </div>
            </div>
            <div class="msg-wrapper msg-time" style="display: none;">
                <div class="clearfix">
                    <p class="msg-box fl">
                        那么，
                    </p>
                </div>
                <div class="clearfix">
                    <p class="msg-box fl">
                        一个来自灵魂的拷问，
                    </p>
                </div>
                <div class="clearfix">
                    <p class="msg-box fl">
                        你愿意为了这个梦想付出多少时间呢？
                    </p>
                </div>
                <div class="time-wrapper">
                    <div class="time-inner">
                        <div class="input-wrapper">
                            <input type="range" value="0" min="0" max="5">
                            <ul class="dream-time">
                                <li class="cur">1年</li>
                                <li>2年</li>
                                <li>3年</li>
                                <li>5年</li>
                                <li>7年</li>
                                <li>10年</li>
                            </ul>
                        </div>
                        <div class="time-btn" onclick="handleSubmit()">确定</div>
                    </div>
                </div>
            </div>
            <div class="msg-wrapper msg-game" style="display: none;">
                <div class="clearfix">
                    <p class="msg-box fl">
                        甚至，你愿意为它投入更多的精力...
                    </p>
                </div>
                <div class="clearfix">
                    <p class="msg-box fl">
                        试试这个游戏吧
                    </p>
                </div>
                <div class="game-wrapper">
                    <div class="game-people">
                        <span class="game-begin"></span>
                        <span class="game-shade"></span>
                    </div>
                    <p>为梦想加油</p>
                    <p>一定时间内点击屏幕</p>
                    <p>点击次数越多能量值越大！</p>
                </div>
            </div>
        </div>
        <div class="game-result">
            <div class="game-btn center-xy">
                <div class="game-clock center-x"></div>
                <div class="game-yun center-x"></div>
                <div class="game-go" onclick="resultPage()"></div>
            </div>
        </div>
        <div class="msg-down clearfix">
            <span class="fl msg-icon"></span>
            <input type="text" placeholder="请填写您的梦想" class="fl">
            <span class="fr msg-send" onclick="handleSend()"></span>
        </div>
    </div>
	<script src="../js/zepto.min.js" type="text/javascript"></script>
	<script src="../js/reset.js"></script>
    <script src="../js/rangeSlider.js"></script>
	<script type="text/javascript">
		$(function() {
			let window_width = document.documentElement.clientWidth;
			let window_height = document.documentElement.clientHeight;

            let rem = window_width/15;
            $('.msg-inner').css('height',(window_height - 3.8*rem)+'px');

            //重定义range组件
            var change = function($input) {
                /*内容可自行定义*/
                console.log("123");
            }

            $('input[type="range"]').RangeSlider({ min: 0,   max: 5,  step: 1,  callback: change});

            //游戏部分
            var gameData = {
                status:false,
                endTime:5,
                now:0,
                num:0,
                timer:null
            };
            $('.game-begin').on('touchstart',function(){
                $(this).hide();
                gameData.status = true;
                gameData.timer = setInterval(function(){
                    if(gameData.now == 5){
                        gameData.status = false;
                        console.log('end');
                        clearInterval(gameData.timer);
                        showResult();
                    }
                    gameData.now ++
                },1000)
            })
            $(document).on('touchstart',function(){
                if(gameData.status){
                    gameData.num+=2
                    $('.game-shade').css('height',(100-gameData.num)+'%');
                    if(gameData.num == 100){
                        gameData.status = false;
                        showResult();
                    }
                }
            })


	    });
        //监听发送事件
        function handleSend(){
            if($('.msg-dream div').length < 2) {
                var val = $('.msg-down input').val();
                var div = document.createElement('div'), p = document.createElement('p');
                div.className = 'clearfix';
                p.className = 'msg-box box-right fr dream';
                p.innerText = val;
                div.appendChild(p);
                $('.msg-dream').append(div);
                $('.msg-down input').val('').attr('readonly','readonly').attr('placeholder','你的梦想已上传');
                setTimeout(function(){
                    $('.msg-time').show();
                    var time_num = 0;
                    var time_timer = setInterval(function(){
                        $('.msg-time div').eq(time_num).show();
                        time_num++
                        if(time_num == 3){
                            clearInterval(time_timer)
                        }
                    },500)
                },500)
            }
        }
        //监听提交事件
        function handleSubmit(){
            //TODO 提交
            var submitData = {
                dream: $('.dream').text()
            }
            var timeNum = $('.time-wrapper input[type=range]').val();
            switch (timeNum){
                case 0:
                    submitData.time = '1年';
                    break;
                case 1:
                    submitData.time = '2年';
                    break;
                case 2:
                    submitData.time = '3年';
                    break;
                case 3:
                    submitData.time = '5年';
                    break;
                case 4:
                    submitData.time = '7年';
                    break;
                case 5:
                    submitData.time = '10年';
                    break;
            }
            $('.msg-game').show();
            $(".msg-inner").scrollTop($('.msg-inner').height());
            console.log(submitData)
        }
        //显示信息页面
        function showMsg(){
            $('.msg-page').addClass('show');
        }
        //显示结果页
        function showResult(){
            $('.game-result').show();
        }

        //跳转到结果页
        function resultPage(){
            window.location.href = 'result.html';
        }
	</script>
</body>
</html>